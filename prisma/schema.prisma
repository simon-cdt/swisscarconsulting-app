// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
}

model User {
  id       String @id @default(cuid())
  username String @unique
  password String
  role     Role   @default(MECHANIC)

  desactivated Boolean @default(false)

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  interventions Intervention[]
}

model Client {
  id         Int        @id @default(autoincrement())
  typeClient TypeClient
  email      String
  phone      String

  address    String?
  postalCode Int?
  city       String?

  firstName String?
  name      String?

  companyName      String?
  contactFirstName String?
  contactName      String?

  vehicules Vehicule[]

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model Vehicule {
  id           String @id @default(cuid())
  clientId     Int
  brand        String
  model        String
  year         Int
  licensePlate String

  insuranceId String?

  chassisNumber      String?
  registrationNumber String?
  lastExpertise      DateTime?
  certificateImage   String?
  receptionType      String?

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  client        Client         @relation(fields: [clientId], references: [id], onDelete: Cascade)
  interventions Intervention[]
  insurance     Insurance?     @relation(fields: [insuranceId], references: [id], onDelete: Cascade)
}

model Intervention {
  id          String   @id @default(cuid())
  userId      String
  vehiculeId  String
  date        DateTime @default(now())
  description String?
  medias      String?
  deleted     Boolean  @default(false)

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  vehicule  Vehicule   @relation(fields: [vehiculeId], references: [id], onDelete: Cascade)
  estimates Estimate[]
}

model Estimate {
  id             String         @id @default(cuid())
  interventionId String
  status         EstimateStatus @default(TOFINISH)
  items          EstimateItem[]
  type           TypeEstimate
  claimNumber    String?

  deleted Boolean @default(false)

  refusalReason String?

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  intervention Intervention @relation(fields: [interventionId], references: [id], onDelete: Cascade)
}

model EstimateItem {
  id         String @id @default(cuid())
  estimateId String

  type ItemType

  designation String
  description String?
  unitPrice   Float
  quantity    Int?
  discount    Float?

  position Int

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  estimate Estimate @relation(fields: [estimateId], references: [id], onDelete: Cascade)
}

model Invoice {
  id String @id @default(cuid())

  estimateId   String
  typeEstimate TypeEstimate
  claimNumber  String?

  interventionId   String
  interventionDate DateTime
  description      String?
  medias           String?

  vehiculeId   String
  brand        String
  model        String
  year         Int
  licensePlate String

  clientId    Int
  typeClient  TypeClient
  name        String
  firstName   String
  email       String
  phone       String
  companyName String?
  address     String?
  postalCode  Int?
  city        String?

  estimateItems String

  pdfUrl String?

  status InvoiceStatus @default(PENDING_PAYMENT)

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model Insurance {
  id    String @id @default(cuid())
  name  String
  email String
  phone String

  vehicules Vehicule[]
}

enum InvoiceStatus {
  PENDING_PAYMENT
  PAID
}

enum ItemType {
  PART
  LABOR
  UPCOMING
}

enum TypeEstimate {
  INDIVIDUAL
  INSURANCE
}

enum EstimateStatus {
  TOFINISH
  PENDING
  ACCEPTED
  SENT_TO_GARAGE
  FINISHED
}

enum TypeClient {
  company
  individual
}

enum Role {
  MECHANIC
  SELLER
  BOTH
  ADMIN
}
